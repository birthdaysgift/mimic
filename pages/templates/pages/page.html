<!DOCTYPE html>
{% load html_attrs %}
{% load static %}
<html lang="en">
<head>
	<meta charset="UTF-8">

	<title>Onlyours</title>

	<link rel="stylesheet" href="{% static 'pages/css/page.css' %}">
    <!--TODO: why i cant include these in their html files-->
    <link rel="stylesheet" href="{% static 'pages/css/all_friends.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/delete_post.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/all_photos.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/all_videos.css' %}">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
<div class="wrapper">
    <!--TODO: refactor this, i dont know how-->
    <div class="page-detail-video-background">
        <video src="" class="page-video-img" controls></video>
    </div>
    <div class="page-detail-photo-background">
        <img src="" class="page-photo-img">
    </div>
    <div class="elephant-panel">
        <!--TODO: bug: Elephant speeding up when left click then right click-->
        <div class="elephant"></div>
    </div>
    <div class="container">
        <h1 class="title-text text-center">Onlyours <small><small>pages</small></small></h1>
        <div class="row">
            <div class="left col-3">
                <div class="avatar-panel">
                    <h4 class="text-center">{{ page_owner.username }}
                        {% if page_owner.username == current_user.username %}
                            <small><a href="{% url 'pages:edit' request.user.username %}">Edit</a></small>
                        {% endif %}
                    </h4>
                    {% if page_owner.avatar %}
                        <img src="{{ page_owner.avatar.url }}" class="user-avatar img-fluid">
                    {% else %}
                        <img src="{% static 'pages/img/avatar_placeholder.png' %}" class="user-avatar img-fluid">
                    {% endif %}
                    {% if page_owner.status %}
                        <p class="status-text text-center">{{ page_owner.status }}</p>
                    {% endif %}
                </div>
                {% if page_owner.username != current_user.username %}
                    <a class="write-message-btn text-center" href="{% url 'talks:talk' page_owner.username 1 %}">Write a message</a>
                {% endif %}
                {% if page_owner != current_user %}
                    <div class="friendship-status-panel">
                        {% if friendship_status == 'friend' %}
                            <p class="friendship-status-text text-center"><small>{{ page_owner.username }} is your friend</small></p>
                            <a href="{% url 'pages:remove_friend' page_owner.username %}" class="remove-friend-btn text-center">Remove</a>
                        {% elif friendship_status == 'requested' %}
                            <p class="friendship-status-text text-center">You've requested a friendship</p>
                            <a class="cancel-friend-request-btn text-center" href="{% url 'pages:cancel_friend_request' page_owner.username %}">Cancel</a>
                        {% elif friendship_status == 'requesting' %}
                            <p class="friendship-status-text text-center"><small>{{ page_owner.username }} requesting your friendship</small></p>
                            <a href="{% url 'pages:accept_friend_request' page_owner.username %}" class="accept-friend-request-btn text-center">Accept</a>
                            <a href="{% url 'pages:deny_friend_request' page_owner.username %}" class="deny-friend-request-btn text-center">Deny</a>
                        {% else %}
                            <p class="friendship-status-text text-center"><small>{{ page_owner.username }} isn't your friend</small></p>
                            <a class="send-friend-request-btn text-center" href="{% url 'pages:send_friend_request' page_owner.username %}">Add to friends</a>
                        {% endif %}
                    </div>
                {% endif %}
                <div class="friends-panel">
                    <b class="friends-text">Friends</b>
                    <!--This link is used in js.-->
                    <a href="{% url 'pages:friends' page_owner.username %}" class="friends-list-link"></a>
                    {% for friend in friends %}
                        <div class="friend-icon">
                            <a href="{% url 'pages:page' friend.username %}">
                                {% if friend.avatar %}
                                    <img src="{{ friend.avatar.url }}" class="friend-avatar">
                                {% else %}
                                    <img src="{% static 'pages/img/avatar_placeholder.png' %}" class="friend-avatar">
                                {% endif %}
                                {% if friend.username|length > 8 %}
                                    <div class="text-center friend-name">{{ friend.username|slice:":9" }}...</div>
                                {% else %}
                                    <div class="text-center friend-name">{{ friend.username }}</div>
                                {% endif %}
                            </a>
                        </div>
                    {% endfor %}
                </div>
                <a href="{% url 'pages:page' current_user.username %}">My page</a>
                <br>
                <a href="{% url 'talks:talk' 'global' 1 %}">Talks</a>
                <br>
                <a href="{% url 'auth_custom:logout' %}">Logout</a>
            </div>
            <div class="middle col-6">
                <div class="about-panel">
                    {% if page_owner.first_name %}
                        <p><b>Name: </b>{{ page_owner.first_name }} {{ page_owner.last_name }}</p>
                    {% endif %}
                    {% if page_owner.birthday %}
                        <p><b>Birthday: </b>{{ page_owner.birthday }}</p>
                    {% endif %}
                    {% if page_owner.city %}
                        <p><b>City: </b>{{ page_owner.city }}</p>
                    {% endif %}
                    <!--TODO: add choice form field to gender-->
                    {% if page_owner.gender %}
                        <p><b>Gender: </b>{{ page_owner.gender }}</p>
                    {% endif %}
                    {% if page_owner.about %}
                        <div class="about-block"><b>About me: </b>
                            <p class="about-text">{{ page_owner.about|linebreaksbr }}</p>
                        </div>
                    {% endif %}
                </div>
                <div class="splitter"></div>
                <div class="posts-panel">
                    <form method="POST">
                        {% csrf_token %}
                        {{ form.non_field_errors}}
                        <!--TODO: get rid of default form validation pop-up window-->
                        <div class="form-info-block">
                            {{ form.text|set_attrs:"class='add-post' placeholder='Add a new post...' oninvalid='this.setCustomValidity(\'\')'" }}
                            <p class="form-info-text text-right">Press Ctrl+Enter to post</p>
                        </div>
                        {{ form.text.errors}}
                    </form>
                    <!--TODO: add links to posts-->
                    {% if posts %}
                        {% for post in posts %}
                            <div class="post">
                                    <a href="{% url 'pages:page' post.sender.username %}">
                                        {% if post.sender.avatar %}
                                            <img src="{{ post.sender.avatar.url }}" class="sender-avatar">
                                        {% else %}
                                            <img src="{% static 'pages/img/avatar_placeholder.png' %}" class="sender-avatar">
                                        {% endif %}
                                    </a>
                                    <div class="post-sender">
                                        <a href="{% url 'pages:page' post.sender.username %}">
                                            <b>{{ post.sender.username }}</b>
                                        </a>
                                        <small>{{ post.date }} {{ post.time }}</small>
                                    </div>
                                    {% if page_owner.username == current_user.username %}
                                        <a class="close-icon"></a>
                                        <!--This link is used in js-->
                                        <a class="close-icon-link" href="{% url 'pages:post_delete_confirm' page_owner.username post.id %}"></a>
                                    {% endif %}
                                    {{ post.text|linebreaks|set_attrs:"class='post-text'" }}
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <div class="right col-3">
                <div class="photo-panel">
                    <div class="photo-text"><b>Photo</b></div>
                    <!--This link is used by js-->
                    <a href="{% url 'pages:photos' page_owner.username %}" class="photos-list-link"></a>
                    {% for photo in photos %}
                        <img src="{{ photo.photo.photo.url }}" class="photo-avatar">
                    {% endfor %}
                </div>
                <div class="video-panel">
                    <div class="video-text"><b>Video</b></div>
                    <!--This link is used by js-->
                    <a href="{% url 'pages:videos' page_owner.username %}" class="videos-list-link"></a>
                    {% for video in videos %}
                        <!--TODO: refactor ofc-->
                        <!--Custom attr src used in js to get access to video instance-->
                        <div src="{{ video.video.video.url }}" class="video-avatar"></div>
                    {% endfor %}
                </div>
                <div class="audio-panel">
                    <a href="" class="audio-text"><b>Audio</b></a>
                    <div class="track-panel">
                        <a href="">
                            <div class="play-icon"></div>
                        </a>
                        <p>
                            <a href=""><b>Artist </b></a> - Title
                        </p>
                    </div>
                    <div class="track-panel">
                            <div class="play-icon"></div>
                        <p>
                            <a href=""><b>Artist </b></a> - Title
                        </p>
                    </div>
                    <div class="track-panel">
                        <div class="play-icon"></div>
                        <p>
                            <a href=""><b>Artist </b></a> - Title
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="{% static 'pages/js/elephant.js' %}"></script>
<script src="{% static 'pages/js/page.js' %}"></script>
</body>
</html>


